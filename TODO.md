# Next：支持后台大量导出ES的数据

后端：

导出前需要的信息：

- ES服务器的IP地址，主机名称，端口，是否需要SSL，URL前缀，压缩，HTTP认证用户和密码；
- 查询命令，索引，一次查询需要ES返回多少个结果，一个CSV文件里面包含多少个结果；
- ES导出的游标生存时间是多久。

导出机制：

- 一个任务，由一个export_worker进程处理，就是不存在两个进程并行处理一次导出任务的情况；
- export_worker进程是常驻后台的进程，一个export_worker处理完一个任务后，会等待下个任务然后处理任务；
- 可以开启多个export_worker进程，这样可以同时处理多个任务，加快速度；
- 由于同时可以开启多个进程，所以需要考虑一个进程处理任务的时候，需要锁定该任务，避免其他进程也处理了相同的任务；
- 锁定可以用文件锁，Redis锁，考虑到单机部署，先实现基于磁盘文件的锁；
- 导出任务可以中断，原理是，每次从ES中查询到一部分数据的时候，处理前先读一下DB中任务的状态，如果已经配置成中断任务，那么就不需要继续处理了。

前端：

- 导出的机制跟监控不同，所以单独做成为一个页面，区别于“监控任务”菜单，比如增加一个“导出任务”菜单；
- 后端需要的信息，都要能在页面上配置；
- 导出任务是一个列表，显示任务的名字、状态，还需要操作的按钮，按钮包括中断任务、开始任务，还需要一个进度条显示任务的进行程度，同时需要一个下载的链接或者按钮；
- 后端需要一个接口，前端定时去查询指定的任务状态，进行到什么程度，这个需要可以批量地查询；
- 任务创建后需要有个详情页面，详情页面用于配置任务的信息，以及查看任务的状态和下载任务文件等。
